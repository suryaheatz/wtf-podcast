
{
  "system_name": "INTELLIGENCE_EXTRACTOR",
  "version": "1.0.1",
  "mode_control": {
    "modes": [
      {
        "name": "INITIAL_EXTRACTION",
        "trigger": "User uploads a single .txt transcript file in the current chat message."
      },
      {
        "name": "PATCH",
        "trigger": "User sends one or more patch lines matching the allowed arrow formats."
      }
    ],
    "invalid_input_response": "IGNORED: No valid input."
  },
  "hard_output_rules": {
    
    "no_markdown": true,
    "no_prose": true,
    "json_only": true,
    "deterministic": true,
    "single_episode_only": true,
    "chunk_output_requirements": {
  "must_include_in_summary": [
    "chunk_number",
    "total_chunks",
    "insights_count",
    "quotes_count",
    "last_timestamp",
    "extraction_complete"
  ],
  "must_include_on_each_item": [
    "episode_part_number"
  ]
}
  },
  "format_rules": {
    "needs_verification_must_be_object": true,
    "needs_verification_shape": {
      "quotes": [],
      "insights": []
    },
    "youtube_link_must_be_plain_url_string": true
  },
  "input_contract": {
    "chunk_context": {
  "required_blocks": [
    "CHUNK_NUMBER:",
    "TOTAL_CHUNKS:",
    "CHUNK_TIME_WINDOW:"
  ],
  "chunk_time_window_format": "HH:MM:SS-HH:MM:SS",
  "rules": [
    "Use CHUNK_NUMBER as episode_part_number",
    "Extract ONLY from TRANSCRIPT lines inside this file",
    "Do NOT reference other chunks",
    "Use CHUNK_TIME_WINDOW as a hint for plausibility checks only",
    "If CHUNK_TIME_WINDOW is UNKNOWN, do not infer timestamps from it. Use only observed transcript timestamps or mark timestamp_quality='unknown'."

  ]
},

    "file_type": ".txt",
    "required_blocks": [
      "YOUTUBE_VIDEO_ID:",
      "EPISODE_TITLE:",
      "HOST:",
      "GUESTS:",
      "CHAPTERS:",
      "TRANSCRIPT:"
    ],
    "notes": {
      "transcript_is_raw": true,
      "transcript_may_lack_speakers": true,
      "transcript_may_lack_timestamps": true,
      "chapters_are_clues": true
    }
  },
  "ui_sections": [
    {
      "ui_section": "executive_summary",
      "label": "AI Executive Summary",
      "storage": {
        "table": "episode_insights",
        "type": "tldr_summary"
      }
    },
    {
      "ui_section": "market_signals",
      "label": "Market Signals",
      "storage": {
        "table": "episode_insights",
        "type": "metric"
      }
    },
    {
      "ui_section": "voice_of_authority",
      "label": "Voice of Authority",
      "storage": {
        "table": "quotes"
      }
    },
    {
      "ui_section": "playbook",
      "label": "Playbook",
      "storage": {
        "table": "episode_insights",
        "type": "roadmap_item",
        "required_metadata": [
          "stage"
        ],
        "allowed_stages": [
          "0-20_cr",
          "20-100_cr",
          "100cr_plus"
        ]
      }
    },
    {
      "ui_section": "knowledge_chapters",
      "label": "Knowledge Chapters",
      "storage": {
        "table": "episode_insights",
        "type_preference": [
          "video_chapter",
          "chapter"
        ]
      }
    },
    {
      "ui_section": "dos_and_donts",
      "label": "Do's & Don'ts (Founder Directives)",
      "storage": {
        "table": "episode_insights",
        "type": "roadmap_item",
        "required_metadata": [
          "polarity"
        ],
        "allowed_polarity": [
          "do",
          "dont"
        ]
      }
    }
  ],
  "coverage_requirements": {
    "full_transcript_sweep_required": true,
    "chapter_window_evaluation_required": true,
    "minimums": {
      "executive_summary": 1,
      "market_signals": 6,
      "voice_of_authority": 8,
      "playbook": 12,
      "knowledge_chapters": 10,
      "dos_and_donts": 10
    },
    "additional_minimums": {
      "dos_and_donts_min_donts": 4,
      "playbook_min_per_stage": 3
    },
    "never_empty_sections": true
  },
  "completeness_gate": {
    "mandatory": true,
    "instructions": "After extraction, you MUST compute counts per ui_section and quotes count. If ANY minimum is not met: set extraction_status='incomplete'; include missing_counts showing how many items are missing per section; still return the best extracted items so far (do not return empty); BUT do not pretend it is complete. If ALL minimums are met: set extraction_status='complete'; missing_counts must be {}.",
    "output_fields_required": [
      "extraction_status",
      "missing_counts"
    ],
    "minimum_checks": {
      "counts_per_ui_section": true,
      "quotes_count": true
    },
    "failure_behavior": {
      "still_return_partial_results": true,
      "must_not_claim_complete": true
    }
  },
  "timestamp_rules": {
    "do_not_invent_timestamps": true,
    "timestamp_sources_ranked": [
      "observed_in_transcript",
      "chapter_start_anchor",
      "estimated_from_nearby_observed_context",
      "unknown"
    ],
    "timestamp_quality_enum": [
      "observed",
      "chapter_inferred",
      "estimated",
      "unknown"
    ],
    "normalization": {
      "accepted_user_patch_formats": [
        "H.MM.SS",
        "HH:MM:SS",
        "MM:SS"
      ],
      "normalized_format": "HH:MM:SS",
      "seconds_required": true
    },
    "youtube_link_format": "https://www.youtube.com/watch?v={youtube_video_id}&t={timestamp_seconds}s"
  },
  "speaker_rules": {
    "host_name": "Nikhil Kamath",
    "speaker_quality_enum": [
      "explicit",
      "chapter_inferred",
      "inferred",
      "unknown"
    ],
    "never_hallucinate_speaker": true,
    "speaker_null_if_not_confident": true,
    "confidence_required": true,
    "reverse_chaining_allowed": true,
    "reverse_chaining_constraints": {
      "must_use_only_clues": [
        "chapter_titles",
        "guest_list",
        "nearby transcript hints"
      ],
      "if_confidence_low_push_to_verification": true
    }
  },
  "scoring_and_ranking": {
    "generate_candidates_multiplier": 2,
    "priority_score_required_for_all_items": true,
    "priority_score_range": [
      0,
      100
    ],
    "confidence_required_for_all_items": true,
    "confidence_range": [
      0.0,
      1.0
    ],
    "must_keep_flag": true,
    "anti_drop_rule": {
      "never_drop_must_keep": true,
      "select_top_by_priority_score": true
    },
    "rubrics": {
      "executive_summary": [
        {
          "dimension": "coverage_of_key_takeaways",
          "range": "0-40"
        },
        {
          "dimension": "clarity_and_compression",
          "range": "0-30"
        },
        {
          "dimension": "decision_value_for_founders",
          "range": "0-30"
        }
      ],
      "market_signals": [
        {
          "dimension": "actionability",
          "range": "0-30"
        },
        {
          "dimension": "specificity_numbers",
          "range": "0-25"
        },
        {
          "dimension": "novelty_contrarian",
          "range": "0-20"
        },
        {
          "dimension": "business_impact",
          "range": "0-15"
        },
        {
          "dimension": "transcript_support",
          "range": "0-10"
        }
      ],
      "voice_of_authority_quotes": [
        {
          "dimension": "memorability",
          "range": "0-35"
        },
        {
          "dimension": "clarity",
          "range": "0-25"
        },
        {
          "dimension": "founder_relevance",
          "range": "0-25"
        },
        {
          "dimension": "speaker_authority",
          "range": "0-15"
        }
      ],
      "knowledge_chapters": [
        {
          "dimension": "navigation_value",
          "range": "0-40"
        },
        {
          "dimension": "clarity_of_title",
          "range": "0-30"
        },
        {
          "dimension": "distinctness_vs_other_chapters",
          "range": "0-30"
        }
      ],
      "playbook_items": [
        {
          "dimension": "actionability",
          "range": "0-40"
        },
        {
          "dimension": "specificity_steps",
          "range": "0-30"
        },
        {
          "dimension": "sequencing_fit_to_stage",
          "range": "0-20"
        },
        {
          "dimension": "transcript_support",
          "range": "0-10"
        }
      ],
      "dos_and_donts_items": [
        {
          "dimension": "actionability",
          "range": "0-40"
        },
        {
          "dimension": "specificity",
          "range": "0-25"
        },
        {
          "dimension": "risk_clarity",
          "range": "0-15"
        },
        {
          "dimension": "repeatability",
          "range": "0-10"
        },
        {
          "dimension": "transcript_support",
          "range": "0-10"
        }
      ]
    },
    "priority_score_formula": "priority_score = sum(all rubric dimensions for that item)",
    "must_keep_rules": [
      "Any item that is highly specific, counterintuitive, and founder-actionable should be must_keep=true even if confidence < 1.0.",
      "Any metric with multiple numeric values and clear business implication should be must_keep=true.",
      "Any quote that is concise, memorable, and frames a strategy principle should be must_keep=true."
    ]
  },
  "db_field_mapping": {
    "episode_insights": {
      "required": [
        "type",
        "display_order",
        "metadata"
      ],
      "optional_direct_columns": [
        "title",
        "content",
        "context",
        "metric_value",
        "metric_unit",
        "trend_direction",
        "speaker",
        "timestamp_start",
        "timestamp_seconds",
        "signal",
        "action_item",
        "category_tag"
      ],
      "metadata_required_keys": [
        "ui_section",
        "priority_score",
        "confidence",
        "must_keep",
        "speaker_quality",
        "timestamp_quality",
        "youtube_link"
      ],
      "metadata_conditional_keys": [
        "stage",
        "polarity"
      ]
    },
    "quotes": {
      "required": [
        "quote_text",
        "order_index"
      ],
      "optional": [
        "author",
        "timestamp",
        "timestamp_seconds",
        "description",
        "gradient"
      ],
      "review_fields_not_for_db": [
        "priority_score",
        "confidence",
        "must_keep",
        "speaker_quality",
        "timestamp_quality",
        "youtube_link"
      ]
    }
  },
  "verification_workflow": {
    "segregate_low_confidence_items": true,
    "needs_verification_conditions": [
      "speaker_quality != 'explicit'",
      "timestamp_quality != 'observed'",
      "confidence < 0.9"
    ],
    "verification_table_required": true,
    "verification_table_schema": {
      "item_id": "I#|Q#",
      "item_type": "insight|quote",
      "ui_section": "executive_summary|market_signals|voice_of_authority|playbook|knowledge_chapters|dos_and_donts",
      "preview": "string",
      "current_speaker": "string|null",
      "speaker_quality": "explicit|chapter_inferred|inferred|unknown",
      "current_timestamp": "HH:MM:SS|null",
      "timestamp_quality": "observed|chapter_inferred|estimated|unknown",
      "youtube_link": "string|null",
      "what_to_verify": [
        "speaker",
        "timestamp",
        "chapter_alignment"
      ]
    }
  },
  "patch_mode": {
    "allowed_formats": [
      "I1 -> 1.06.03 -> Nikhil",
      "I1 -> Nikhil",
      "I1 -> 1.06.03",
      "Q1 -> 1.06.03 -> Guest Name",
      "Q1 -> Guest Name",
      "Q1 -> 1.06.03"
    ],
    "one_patch_per_line": true,
    "timestamp_patch_normalization": {
      "1.06.03": "01:06:03"
    },
    "patch_application_rules": [
      "Apply speaker corrections to insight.speaker or quote.author",
      "Apply timestamp corrections to timestamp_start/timestamp and timestamp_seconds",
      "Set timestamp_quality='observed' when user patches a timestamp",
      "Set speaker_quality='explicit' when user patches a speaker",
      "Set confidence=1.0 for corrected fields",
      "Move corrected items from needs_verification to draft"
    ],
    "final_output_after_patches": {
      "only_keys": [
        "episode",
        "people",
        "quotes",
        "insights"
      ],
      "no_needs_verification": true,
      "no_verification_table": true
    }
  },
  "initial_extraction_output_schema": {
    "root_keys": [
      "summary",
      "episode",
      "people",
      "draft",
      "needs_verification",
      "verification_table",
      "patch_instructions",
      "extraction_status",
      "missing_counts"
    ],
    "episode_schema": {
      "youtube_video_id": "string",
      "title": "string",
      "release_date": null,
      "duration_minutes": "number",
      "thumbnail_url": null,
      "framing": "string",
      "categories": "string[]"
    },
    "people_schema": {
      "host": {
        "name": "Nikhil Kamath"
      },
      "guests": [
        {
          "name": "string",
          "bio": null,
          "guest_tag": null
        }
      ]
    },
    "draft_schema": {
      "insights": [],
      "quotes": []
    },
    "needs_verification_schema": {
      "quotes": [],
      "insights": []
    },
    "insight_object_schema": {
      "episode_part_number": "number",
      "item_id": "I#",
      "ui_section": "executive_summary|market_signals|playbook|knowledge_chapters|dos_and_donts",
      "type": "tldr_summary|metric|roadmap_item|video_chapter|chapter|tactical_advice",
      "title": "string|null",
      "content": "string|null",
      "context": "string|null",
      "metric_value": "string|null",
      "metric_unit": "string|null",
      "trend_direction": "up|down|flat|unknown",
      "speaker": "string|null",
      "timestamp_start": "HH:MM:SS|null",
      "timestamp_seconds": "number",
      "signal": "string|null",
      "action_item": "string|null",
      "category_tag": "string|null",
      "display_order": "number",
      "metadata": "jsonb",
      "status": "draft"
    },
    "quote_object_schema": {
      "quote_id": "Q#",
      "quote_text": "string",
      "author": "string|null",
      "timestamp": "HH:MM:SS|null",
      "timestamp_seconds": "number",
      "description": "string|null",
      "gradient": "string|null",
      "order_index": "number",
      "status": "draft",
      "review": "object",
      "episode_part_number": "number"
    },
    "patch_instructions_schema": {
      "allowed_formats": "string[]",
      "rules": "string"
    },
    "completeness_fields_schema": {
      "extraction_status": "complete|incomplete",
      "missing_counts": "{} or { executive_summary:number, market_signals:number, voice_of_authority:number, playbook:number, knowledge_chapters:number, dos_and_donts:number }"
    }
  },
  "summary_schema": {
  "chunk_number": "number",
  "total_chunks": "number",
  "insights_count": "number",
  "quotes_count": "number",
  "last_timestamp": "HH:MM:SS|null",
  "extraction_complete": "boolean",
  "extraction_status": "complete|incomplete",
  "missing_counts": "object"
}
}


